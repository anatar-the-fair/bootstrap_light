#!/bin/sh
# Login shell profile — environment variables & startup tasks
### ────────── Default Applications ──────────
export EDITOR="nvim"
export TERMINAL="kitty"
export TERMINAL_PROG="kitty"
export BROWSER="firefox"

### ────────── XDG Directories ──────────
export XDG_DATA_HOME="$HOME/.local/share"
export XDG_CACHE_HOME="$HOME/.cache"
export XDG_CONFIG_HOME="$HOME/.config"
export XDG_STATE_HOME="$HOME/.local/state"

# Let GTK and other apps find themes/icons in ~/.local
export XDG_DATA_DIRS="$HOME/.local/share${XDG_DATA_DIRS:+:$XDG_DATA_DIRS}:/usr/local/share:/usr/share"

# Create important XDG directories
mkdir -p \
  "$XDG_DATA_HOME" \
  "$XDG_CACHE_HOME/zsh" \
  "$XDG_CONFIG_HOME" \
  "$XDG_STATE_HOME/zsh"

### ────────── Zsh Files ──────────
export ZDOTDIR="$XDG_CONFIG_HOME/zsh"
export HISTFILE="$XDG_STATE_HOME/zsh/history"
export HISTSIZE=1000000
export SAVEHIST=1000000
export HIST_STAMPS="dd.mm.yyyy"
export ZSH_COMPDUMP="$XDG_CACHE_HOME/zsh/.zcompdump"
touch "$HISTFILE"

### ────────── Program Config Paths ──────────
export XINITRC="$XDG_CONFIG_HOME/x11/xinitrc"
export XPROFILE="$XDG_CONFIG_HOME/x11/xprofile"
export XRESOURCES="$XDG_CONFIG_HOME/x11/xresources"

export GIT_CONFIG_GLOBAL="$HOME/.config/git/config"

### ────────── PATH Setup ──────────
# Ensure ~/.local/bin and its subdirectories are included
if [ -d "$HOME/.local/bin" ]; then
  LOCAL_BIN_PATHS="$(find "$HOME/.local/bin" -type d 2>/dev/null | paste -sd ':' -)"
  
  # Avoid duplicate entries
  for dir in $(echo "$LOCAL_BIN_PATHS" | tr ':' '\n'); do
    case ":$PATH:" in
      *":$dir:"*) ;;  # Already in PATH, do nothing
      *) export PATH="$dir:$PATH" ;;  # Prepend to give priority
    esac
  done
fi

### ────────── Theming & Prompt ──────────
# Less Colors
export LESS="R"
export LESS_TERMCAP_mb="$(printf '%b' '\e[1;31m')"
export LESS_TERMCAP_md="$(printf '%b' '\e[1;36m')"
export LESS_TERMCAP_me="$(printf '%b' '\e[0m')"
export LESS_TERMCAP_so="$(printf '%b' '\e[01;44;33m')"
export LESS_TERMCAP_se="$(printf '%b' '\e[0m')"
export LESS_TERMCAP_us="$(printf '%b' '\e[1;32m')"
export LESS_TERMCAP_ue="$(printf '%b' '\e[0m')"
export LESSOPEN="| /usr/bin/highlight -O ansi %s 2>/dev/null"

# FZF
export FZF_DEFAULT_OPTS="--style minimal --color 16 --layout=reverse --height 30% --preview='bat -p --color=always {}'"
export FZF_CTRL_R_OPTS="--style minimal --color 16 --info inline --no-sort --no-preview"

# Man pages in color
export MANPAGER="less -R --use-color -Dd+r -Du+b"

### ────────── Background Tasks ──────────
[ ! -f "$XDG_CONFIG_HOME/shell/shortcutrc" ] && setsid -f shortcuts >/dev/null 2>&1
